clear, clc, close all

GainsdB = 5:20;

%% 4-PAM
Preq4.eq_spaced = [-18.0082601978660,-18.4908834238493,-18.8732259198197,-19.1563776928026,-19.3500461482086,-19.4706820641105,-19.5374405820865,-19.5681199418059,-19.5766990791637,-19.5729477613910,-19.5631334155183,-19.5510016675673,-19.5386426157298,-19.5271244344728,-19.5169142287404,-19.5081422046332];
Preq4.optimized = [-18.6990526359951,-19.4684546406341,-20.1951385242573,-20.8720949397068,-21.4938290066797,-22.0609482050620,-22.5542811541481,-22.9836569023122,-23.3221470049156,-23.5741610347077,-23.7557051009919,-23.8805208078713,-23.9625638352545,-24.0142981649637,-24.0455960184381,-24.0636563309996];

ber4.eq_spaced.est = [0.0197055195384536,0.0113667337474086,0.00602450915944267,0.00291697652968424,0.00128086636826672,0.000505019164399632,0.000176405904627002,5.34489479642851e-05,1.35111996031606e-05,2.67082182054487e-06,3.77899822538592e-07,3.44206059190061e-08,1.78250379725929e-09,4.51771853185633e-11,4.65101341144970e-13,1.53704979193101e-15,1.20974873821351e-18];
ber4.eq_spaced.count = [0.0203339041095890,0.0115582191780822,0.00587084148727984,0.00354696673189824,0.00122309197651663,0.000458659491193738,0.000122309197651663,3.05772994129159e-05,3.05772994129159e-05,0,0,0,0,0,0,0,0];
ber4.eq_spaced.gauss = [0.0198268462144531,0.0111628982562379,0.00588385574798090,0.00290528626314988,0.00133839344641014,0.000570091292356713,0.000220836057952416,7.53361172517077e-05,2.14807049610492e-05,4.78423274033799e-06,7.69920717277906e-07,8.17776239039359e-08,5.13377212957555e-09,1.65959693334534e-10,2.32396666914533e-12,1.13341978224946e-14,1.46025734994973e-17];

ber4.optimized.est = [0.00485288086313917,0.000757397933955576,8.81933286852735e-05,1.54585758742629e-05,3.11583427912887e-06,4.73205164025687e-07,4.81590676399726e-08,3.00824468124427e-09,1.03038170465817e-10,1.65576592501728e-12,1.00925072570850e-14,1.77142371748783e-17,6.34919458203236e-21,3.03877601994630e-25,1.14444740637776e-30,1.74856536731276e-37,4.71663867885244e-46];
ber4.optimized.count = [0.00336350293542074,0.000428082191780822,3.05772994129159e-05,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
ber4.optimized.gauss = [0.00202650828649485,0.000498706365605256,0.000214803280745850,8.20974167102300e-05,2.59729877321307e-05,6.55283489112738e-06,1.25221159258902e-06,1.68080209374536e-07,1.42928156884050e-08,6.75401951475656e-10,1.51126171264600e-11,1.31726103403633e-13,3.51131371440044e-16,2.11102785891340e-19,1.94630209938890e-23,1.68817331691694e-28,7.43427257221101e-35];

%% 8-PAM
Preq8.eq_spaced = [-14.0681036874773,-14.2006762117688,-14.2531976167840,-14.2523616434979,-14.2209787979100,-14.1759309777863,-14.1276533507628,-14.0816971581333,-14.0405990121812,-14.0051867884402,-13.9753875229934,-13.9507041970995,-13.9304800478335,-13.9140370201949,-13.9007428285538,-13.8900387615159];
Preq8.optimized = [-15.5193768061899,-16.1695971410753,-16.7439541039589,-17.2684968392372,-17.7394027611374,-18.1297412852279,-18.4420615246319,-18.6942220020107,-18.8911416733654,-19.0329416149185,-19.1262655273680,-19.1839685676781,-19.2188081883845,-19.2398422882402,-19.2522304453661,-19.2589674294695];

ber8.eq_spaced.est = [0.026392935745931,0.011077137820492,0.003535347130539,7.908292393355741e-04,1.130522588193097e-04,8.785789692874868e-06,2.726840007615458e-07,1.997185469595126e-09];
ber8.eq_spaced.count = [0.027071102413568,0.012210534898891,0.003057729941292,8.357795172863666e-04,8.153946510110893e-05,2.038486627527723e-05,0,0];
ber8.eq_spaced.gauss = [0.026949524739294,0.011129613104333,0.003560427496984,8.240986590454056e-04,1.261634163991545e-04,1.059970361377235e-05,3.537954709545181e-07,2.863641640647093e-09];

ber8.optimized.est = [0.008435541725795,3.955419730494819e-04,9.990919457567355e-06,4.032419696337075e-07,9.683028115652236e-09,4.600771434225841e-11,1.166660715828071e-14,2.849646401546598e-20];
ber8.optimized.count = [0.007644324853229,1.834637964774951e-04,0,0,0,0,0,0];
ber8.optimized.gauss = [0.007443564016744,2.748285756036336e-04,3.383242512584333e-05,3.426551328183046e-06,1.831519199187414e-07,2.378275337820170e-09,3.014835374000760e-12,9.846974251583610e-17];

%% 16-PAM
Preq16.eq_spaced = [-9.76524916682775,-9.61414881705920,-9.46105174127166,-9.32149088341601,-9.20107034488147,-9.10033296468116,-9.01760501212438,-8.95042981751509,-8.89626790067560,-8.85279708733913,-8.81801223221525,-8.79023464326519,-8.76808409470953,-8.75043831032738,-8.73639122589467,-8.72521476390843];
Preq16.optimized = [-12.2728814232099,-12.7376285085630,-13.1492198997005,-13.5079750264018,-13.8091280109427,-14.0538881687968,-14.2492787548259,-14.4024210239428,-14.5173798954972,-14.5976720353166,-14.6490389120551,-14.6792172570500,-14.6955376314269,-14.7035008059750,-14.7065708368739,-14.7067960334085];

ber16.eq_spaced.est = [0.030100605725019,0.015254565162239,0.006156846850416,0.001825069534682,3.623011942435434e-04,4.315504660480936e-05,2.546061890098896e-06,5.064043115984085e-08,1.724621463277013e-10];
ber16.eq_spaced.count = [0.030485567514677,0.015594422700587,0.006146037181996,0.001528864970646,3.363502935420744e-04,3.057729941291585e-05,0,0,0];
ber16.eq_spaced.gauss = [0.030880740396416,0.015486404117341,0.006218983065329,0.001850345030526,3.738412542686630e-04,4.596705657525885e-05,2.811175419511875e-06,5.812067904780210e-08,2.099427416639162e-10];

ber16.optimized.est = [0.008847857434691,8.461791114733274e-04,2.926145403558258e-05,1.436336262239419e-06,8.314224951607377e-08,2.214520193257365e-09,8.514083529407688e-12,1.531360239226395e-15,2.329836735078760e-21];
ber16.optimized.count = [0.011359466731898,8.714530332681017e-04,4.586594911937377e-05,0,0,0,0,0,0];
ber16.optimized.gauss = [0.009570247907830,5.750985372552771e-04,5.237975703671963e-05,6.126215130140152e-06,6.775993510169459e-07,3.217704547302721e-08,3.053383262802886e-10,2.321116194004688e-13,3.495386930971563e-18];

figure, box on, grid on, hold on
plot(GainsdB, Preq4.eq_spaced, '-o');
plot(GainsdB, Preq8.eq_spaced, '-o');
plot(GainsdB, Preq16.eq_spaced, '-o');
xlabel('SOA Gain (dB)')
ylabel('Required Transmitted Power (dBm)')
legend('4-PAM', '8-PAM', '16-PAM', 'Location', 'SouthEast')
set(gca, 'xtick', GainsdB)
axis([GainsdB([1 end]) -26 -8])

figure, box on, grid on, hold on
plot(GainsdB, Preq4.optimized, '-s');
plot(GainsdB, Preq8.optimized, '-s');
plot(GainsdB, Preq16.optimized, '-s');
xlabel('SOA Gain (dB)')
ylabel('Required Transmitted Power (dBm)')
legend('4-PAM', '8-PAM', '16-PAM')
set(gca, 'xtick', GainsdB)
axis([GainsdB([1 end]) -26 -8])

%
figure, subplot(211), hold on
PtxdBm = -26:1:-10;
plot(PtxdBm, log10(ber4.eq_spaced.est))
plot(PtxdBm, log10(ber4.eq_spaced.count), '-o')
plot(PtxdBm, log10(ber4.eq_spaced.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')

subplot(212), hold on
plot(PtxdBm, log10(ber4.optimized.est))
plot(PtxdBm, log10(ber4.optimized.count), '-o')
plot(PtxdBm, log10(ber4.optimized.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')

figure, subplot(211), hold on
PtxdBm = -22:2:-8;
plot(PtxdBm, log10(ber8.eq_spaced.est))
plot(PtxdBm, log10(ber8.eq_spaced.count), '-o')
plot(PtxdBm, log10(ber8.eq_spaced.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')

subplot(212), hold on
plot(PtxdBm, log10(ber8.optimized.est))
plot(PtxdBm, log10(ber8.optimized.count), '-o')
plot(PtxdBm, log10(ber8.optimized.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')

figure, subplot(211), hold on
PtxdBm = -18:2:-2;
plot(PtxdBm, log10(ber16.eq_spaced.est))
plot(PtxdBm, log10(ber16.eq_spaced.count), '-o')
plot(PtxdBm, log10(ber16.eq_spaced.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')

subplot(212), hold on
plot(PtxdBm, log10(ber16.optimized.est))
plot(PtxdBm, log10(ber16.optimized.count), '-o')
plot(PtxdBm, log10(ber16.optimized.gauss))
legend('Estimated', 'Counted', 'Gaussian Approximation')


